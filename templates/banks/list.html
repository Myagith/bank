{% extends 'base.html' %}
{% block title %}Gestion des Banques{% endblock %}

{% block content %}
<div class="dashboard-header">
  <h2>ğŸ¦ Gestion des Banques</h2>
  <a href="/banks/create/" class="btn btn-primary">â• Nouvelle Banque</a>
</div>

<!-- Statistiques -->
<div class="stats-grid">
  <div class="stat-card">
    <div class="stat-icon">ğŸ¦</div>
    <div class="stat-content">
      <div class="stat-value">{{ total_banks }}</div>
      <div class="stat-label">Total Banques</div>
    </div>
  </div>
  <div class="stat-card">
    <div class="stat-icon">ğŸ‘¥</div>
    <div class="stat-content">
      <div class="stat-value">{{ total_customers }}</div>
      <div class="stat-label">Total Clients</div>
    </div>
  </div>
  <div class="stat-card">
    <div class="stat-icon">ğŸ’³</div>
    <div class="stat-content">
      <div class="stat-value">{{ total_accounts }}</div>
      <div class="stat-label">Total Comptes</div>
    </div>
  </div>
  <div class="stat-card">
    <div class="stat-icon">ğŸ’°</div>
    <div class="stat-content">
      <div class="stat-value">{{ total_balance|floatformat:0 }} FCFA</div>
      <div class="stat-label">Solde Total</div>
    </div>
  </div>
</div>

<!-- Filtres -->
<div class="filters-card">
  <h3>ğŸ” Filtres</h3>
  <form method="get" class="filters-form">
    <div class="filters-grid">
      <div class="filter-group">
        <label for="name">ğŸ¦ Nom de la banque</label>
        <input type="text" name="name" id="name" class="form-control" 
               value="{{ request.GET.name }}" placeholder="Rechercher par nom...">
      </div>
      
      <div class="filter-group">
        <label for="country">ğŸŒ Pays</label>
        <select name="country" id="country" class="form-select">
          <option value="">Tous les pays</option>
          <option value="CÃ´te d'Ivoire" {% if request.GET.country == 'CÃ´te d\'Ivoire' %}selected{% endif %}>CÃ´te d'Ivoire</option>
          <option value="SÃ©nÃ©gal" {% if request.GET.country == 'SÃ©nÃ©gal' %}selected{% endif %}>SÃ©nÃ©gal</option>
          <option value="Mali" {% if request.GET.country == 'Mali' %}selected{% endif %}>Mali</option>
          <option value="Burkina Faso" {% if request.GET.country == 'Burkina Faso' %}selected{% endif %}>Burkina Faso</option>
          <option value="Niger" {% if request.GET.country == 'Niger' %}selected{% endif %}>Niger</option>
          <option value="Togo" {% if request.GET.country == 'Togo' %}selected{% endif %}>Togo</option>
          <option value="BÃ©nin" {% if request.GET.country == 'BÃ©nin' %}selected{% endif %}>BÃ©nin</option>
          <option value="GuinÃ©e" {% if request.GET.country == 'GuinÃ©e' %}selected{% endif %}>GuinÃ©e</option>
        </select>
      </div>
      
      <div class="filter-group">
        <label for="city">ğŸ™ï¸ Ville</label>
        <input type="text" name="city" id="city" class="form-control" 
               value="{{ request.GET.city }}" placeholder="Rechercher par ville...">
      </div>
      
      <div class="filter-group">
        <label for="customer_count">ğŸ‘¥ Nombre de Clients</label>
        <select name="customer_count" id="customer_count" class="form-select">
          <option value="">Tous</option>
          <option value="0" {% if request.GET.customer_count == '0' %}selected{% endif %}>Aucun client</option>
          <option value="1-10" {% if request.GET.customer_count == '1-10' %}selected{% endif %}>1-10 clients</option>
          <option value="11-50" {% if request.GET.customer_count == '11-50' %}selected{% endif %}>11-50 clients</option>
          <option value="51-100" {% if request.GET.customer_count == '51-100' %}selected{% endif %}>51-100 clients</option>
          <option value="100+" {% if request.GET.customer_count == '100+' %}selected{% endif %}>Plus de 100 clients</option>
        </select>
      </div>
    </div>
    
    <div class="filters-actions">
      <button type="submit" class="btn btn-primary">ğŸ” Filtrer</button>
      <a href="/banks/" class="btn btn-secondary">ğŸ”„ RÃ©initialiser</a>
    </div>
  </form>
</div>

<!-- Liste des banques -->
<div class="banks-section">
  <div class="section-header">
    <h3>ğŸ“‹ Liste des Banques ({{ banks.count }})</h3>
    {% if request.GET %}
      <span class="active-filters">
        Filtres actifs: 
        {% for key, value in request.GET.items %}
          {% if value and key != 'page' %}
            <span class="filter-tag">{{ key }}: {{ value }}</span>
          {% endif %}
        {% endfor %}
      </span>
    {% endif %}
  </div>

  <div class="banks-grid">
    {% for bank in banks %}
      <div class="bank-card">
        <div class="bank-header">
          <div class="bank-name">{{ bank.name }}</div>
          <div class="bank-location">
            <span class="location-badge">{{ bank.city }}, {{ bank.country }}</span>
          </div>
        </div>
        
        <div class="bank-info">
          <div class="info-row">
            <span class="info-label">ğŸ“§ Email:</span>
            <span class="info-value">{{ bank.email }}</span>
          </div>
          <div class="info-row">
            <span class="info-label">ğŸ“ TÃ©lÃ©phone:</span>
            <span class="info-value">{{ bank.phone }}</span>
          </div>
          <div class="info-row">
            <span class="info-label">ğŸ‘¥ Clients:</span>
            <span class="info-value">
              <span class="customer-count-badge">{{ bank.customers.count }}</span>
            </span>
          </div>
          <div class="info-row">
            <span class="info-label">ğŸ’³ Comptes:</span>
            <span class="info-value">
              {% with total_accounts=bank.customers.all|sum_accounts %}
                <span class="account-count-badge">{{ total_accounts }}</span>
              {% endwith %}
            </span>
          </div>
          <div class="info-row">
            <span class="info-label">ğŸ’° Solde Total:</span>
            <span class="info-value balance">
              {% with total_balance=bank.customers.all|sum_balance %}
                {{ total_balance|floatformat:0 }} FCFA
              {% endwith %}
            </span>
          </div>
          <div class="info-row">
            <span class="info-label">ğŸ“… CrÃ©Ã©e le:</span>
            <span class="info-value">{{ bank.created_at|date:"d/m/Y" }}</span>
          </div>
        </div>
        
        <div class="bank-actions">
          <a href="/banks/{{ bank.pk }}/" class="btn btn-sm btn-info">ğŸ‘ï¸ DÃ©tails</a>
          <a href="/banks/{{ bank.pk }}/update/" class="btn btn-sm btn-warning">âœï¸ Modifier</a>
          <a href="/banks/{{ bank.pk }}/delete/" class="btn btn-sm btn-danger" 
             onclick="return confirm('ÃŠtes-vous sÃ»r de vouloir supprimer cette banque ?')">ğŸ—‘ï¸ Supprimer</a>
        </div>
      </div>
    {% empty %}
      <div class="empty-state">
        <div class="empty-icon">ğŸ¦</div>
        <h3>Aucune banque trouvÃ©e</h3>
        <p>{% if request.GET %}Aucune banque ne correspond Ã  vos critÃ¨res de recherche.{% else %}Aucune banque n'a encore Ã©tÃ© crÃ©Ã©e.{% endif %}</p>
        <a href="/banks/create/" class="btn btn-primary">â• CrÃ©er la premiÃ¨re banque</a>
      </div>
    {% endfor %}
  </div>
</div>

<!-- Pagination -->
{% if banks.has_other_pages %}
  <div class="pagination">
    {% if banks.has_previous %}
      <a href="?page={{ banks.previous_page_number }}{% for key, value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}" class="btn btn-sm">â† PrÃ©cÃ©dent</a>
    {% endif %}
    
    <span class="page-info">
      Page {{ banks.number }} sur {{ banks.paginator.num_pages }}
    </span>
    
    {% if banks.has_next %}
      <a href="?page={{ banks.next_page_number }}{% for key, value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}" class="btn btn-sm">Suivant â†’</a>
    {% endif %}
  </div>
{% endif %}
{% endblock %}